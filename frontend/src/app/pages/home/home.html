<div class="home-container container-fluid p-0">
  <app-navbar></app-navbar>
  <app-hero></app-hero>
  <app-info-cards></app-info-cards>
  <app-courses></app-courses>

  <button *ngIf="isUserAdmin" class="admin-students-btn" (click)="toggleAdminPopup()">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="-5 0 34 24" fill="currentColor" class="users-icon">
      <g transform="translate(-4, 1) scale(0.75)" opacity="0.6">
        <path fill-rule="evenodd" d="M7.5 6a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0ZM3.751 20.105a8.25 8.25 0 0 1 16.498 0 .75.75 0 0 1-.437.695A18.683 18.683 0 0 1 12 22.5c-2.786 0-5.433-.608-7.812-1.7a.75.75 0 0 1-.437-.695Z" clip-rule="evenodd" />
      </g>
      <g transform="translate(10, 1) scale(0.75)" opacity="0.6">
        <path fill-rule="evenodd" d="M7.5 6a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0ZM3.751 20.105a8.25 8.25 0 0 1 16.498 0 .75.75 0 0 1-.437.695A18.683 18.683 0 0 1 12 22.5c-2.786 0-5.433-.608-7.812-1.7a.75.75 0 0 1-.437-.695Z" clip-rule="evenodd" />
      </g>
      <g transform="translate(2, 3) scale(0.85)">
        <path fill-rule="evenodd" d="M7.5 6a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0ZM3.751 20.105a8.25 8.25 0 0 1 16.498 0 .75.75 0 0 1-.437.695A18.683 18.683 0 0 1 12 22.5c-2.786 0-5.433-.608-7.812-1.7a.75.75 0 0 1-.437-.695Z" clip-rule="evenodd" />
      </g>
    </svg>
  </button>

  <div class="admin-popup-overlay" *ngIf="showAdminPopup" (click)="closeAdminPopup()">
    <div class="admin-popup-content" (click)="$event.stopPropagation()">
      <div class="popup-header">
        <h3>Students List</h3>
        <button class="close-popup" (click)="closeAdminPopup()">&times;</button>
      </div>

      <div class="popup-body">
        <div class="search-container">
          <input
            type="text"
            [(ngModel)]="searchTerm"
            placeholder="Search username..."
            class="popup-search-input"
          >
        </div>

        <div *ngIf="filteredStudents.length > 0; else noStudents">
          <ul class="student-list">
            <li *ngFor="let student of filteredStudents" class="student-list-item">
              <span class="student-name">{{ student.username }}</span>
              <div class="action-buttons">
                <button
                  type="button"
                  class="btn-action btn-promote"
                  (click)="askMakeAdmin(student.id, student.username)">
                  Make Admin
                </button>
                <button
                  *ngIf="!student.isBanned"
                  type="button"
                  class="btn-action btn-ban"
                  (click)="banUser(student.id, student.username)">
                  Ban
                </button>
                <button
                  *ngIf="student.isBanned"
                  type="button"
                  class="btn-action btn-unban"
                  (click)="unbanUser(student.id, student.username)">
                  Unban
                </button>
              </div>
            </li>
          </ul>
        </div>

        <ng-template #noStudents>
          <p style="text-align: center; color: #888; margin-top: 20px;">
            No students found matching "{{ searchTerm }}".
          </p>
        </ng-template>
      </div>
    </div>
  </div>
  <div class="admin-popup-overlay z-high" *ngIf="showPromotePopup" (click)="closePromotePopup()">
    <div class="admin-popup-content promote-popup" (click)="$event.stopPropagation()">
      <div class="popup-header">
        <h3>Confirm Promotion</h3>
        <button class="close-popup" (click)="closePromotePopup()">&times;</button>
      </div>
      <div class="popup-body text-center">
        <p>Are you sure you want to promote this user to Admin?</p>
        <p class="fw-bold text-white fs-5">"{{ userToPromoteName }}"</p>

        <div class="d-flex justify-content-center gap-3 mt-4">
          <button class="btn btn-secondary" (click)="closePromotePopup()">Cancel</button>
          <button class="btn btn-success-custom" (click)="confirmMakeAdmin()">Make Admin</button>
        </div>
      </div>
    </div>
  </div>
</div>
